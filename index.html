<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Herramientas para el Éxito Emprendedor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .track-persona { background: linear-gradient(135deg, #8B5CF6, #EC4899); }
        .track-proyecto { background: linear-gradient(135deg, #3B82F6, #06B6D4); }
        .track-comunidad { background: linear-gradient(135deg, #10B981, #059669); }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app" class="max-w-md mx-auto bg-gray-50 min-h-screen">
        <!-- App será renderizada aquí -->
    </div>

    <script>
        // Estado de la aplicación
        let state = {
            selectedTrack: 0,
            selectedWeek: 1,
            completedChallenges: JSON.parse(localStorage.getItem('ventureGuideProgress') || '[]'),
            selectedCard: null
        };

        // Datos de las tarjetas del CSV
        const cardsData = [
            {id: "0-1-0", name: "Define tus recursos personales", details: "Lorem ipsum dolor sit amet consectetur adipiscing elit. Sit amet consectetur adipiscing elit quisque faucibus ex. Adipiscing elit quisque faucibus ex sapien vitae pellentesque.", evidence: "Lorem ipsum dolor sit amet consectetur adipiscing elit.", track: "Persona", week: 1, duration: 1, trackId: 0, levelId: 1, cardIndex: 0, dependencies: null},
            {id: "1-2-0", name: "Define tu mapa de ruta", details: "Lorem ipsum dolor sit amet consectetur adipiscing elit. Sit amet consectetur adipiscing elit quisque faucibus ex. Adipiscing elit quisque faucibus ex sapien vitae pellentesque.", evidence: "Lorem ipsum dolor sit amet consectetur adipiscing elit.", track: "Iniciativa", week: 1, duration: 2, trackId: 1, levelId: 2, cardIndex: 0, dependencies: null},
            {id: "1-2-0", name: "Itera tu mapa de ruta", details: "Lorem ipsum dolor sit amet consectetur adipiscing elit. Sit amet consectetur adipiscing elit quisque faucibus ex. Adipiscing elit quisque faucibus ex sapien vitae pellentesque.", evidence: "Lorem ipsum dolor sit amet consectetur adipiscing elit.", track: "Iniciativa", week: 3, duration: 2, trackId: 1, levelId: 2, cardIndex: 0, dependencies: "1-2-0"},
            {id: "1-2-0", name: "Recursos del ecosistema", details: "Lorem ipsum dolor sit amet consectetur adipiscing elit. Sit amet consectetur adipiscing elit quisque faucibus ex. Adipiscing elit quisque faucibus ex sapien vitae pellentesque.", evidence: "Lorem ipsum dolor sit amet consectetur adipiscing elit.", track: "Iniciativa", week: 4, duration: 2, trackId: 1, levelId: 2, cardIndex: 0, dependencies: "1-2-0"},
            {id: "1-2-1", name: "Diseña tablero de seguimiento", details: "Lorem ipsum dolor sit amet consectetur adipiscing elit. Sit amet consectetur adipiscing elit quisque faucibus ex. Adipiscing elit quisque faucibus ex sapien vitae pellentesque.", evidence: "Lorem ipsum dolor sit amet consectetur adipiscing elit.", track: "Iniciativa", week: 1, duration: 2, trackId: 1, levelId: 2, cardIndex: 1, dependencies: null},
            {id: "1-2-1", name: "Itera tu tablero de seguimiento", details: "Lorem ipsum dolor sit amet consectetur adipiscing elit. Sit amet consectetur adipiscing elit quisque faucibus ex. Adipiscing elit quisque faucibus ex sapien vitae pellentesque.", evidence: "Lorem ipsum dolor sit amet consectetur adipiscing elit.", track: "Iniciativa", week: 3, duration: 2, trackId: 1, levelId: 2, cardIndex: 1, dependencies: "1-2-1"},
            {id: "1-2-0", name: "Plan de redes sociales", details: "Lorem ipsum dolor sit amet consectetur adipiscing elit. Sit amet consectetur adipiscing elit quisque faucibus ex. Adipiscing elit quisque faucibus ex sapien vitae pellentesque.", evidence: "Lorem ipsum dolor sit amet consectetur adipiscing elit.", track: "Iniciativa", week: 2, duration: 2, trackId: 1, levelId: 2, cardIndex: 0, dependencies: null},
            {id: "1-1-0", name: "Post en redes sociales", details: "Lorem ipsum dolor sit amet consectetur adipiscing elit. Sit amet consectetur adipiscing elit quisque faucibus ex. Adipiscing elit quisque faucibus ex sapien vitae pellentesque.", evidence: "Lorem ipsum dolor sit amet consectetur adipiscing elit.", track: "Iniciativa", week: 3, duration: 1, trackId: 1, levelId: 1, cardIndex: 0, dependencies: "1-2-0"},
            {id: "1-1-0", name: "Post en redes sociales", details: "Lorem ipsum dolor sit amet consectetur adipiscing elit. Sit amet consectetur adipiscing elit quisque faucibus ex. Adipiscing elit quisque faucibus ex sapien vitae pellentesque.", evidence: "Lorem ipsum dolor sit amet consectetur adipiscing elit.", track: "Iniciativa", week: 4, duration: 1, trackId: 1, levelId: 1, cardIndex: 0, dependencies: "1-2-0"},
            {id: "1-1-0", name: "Post en redes sociales", details: "Lorem ipsum dolor sit amet consectetur adipiscing elit. Sit amet consectetur adipiscing elit quisque faucibus ex. Adipiscing elit quisque faucibus ex sapien vitae pellentesque.", evidence: "Lorem ipsum dolor sit amet consectetur adipiscing elit.", track: "Iniciativa", week: 5, duration: 1, trackId: 1, levelId: 1, cardIndex: 0, dependencies: "1-2-0"},
            {id: "0-2-0", name: "Recursos financieros a tu alcance", details: "Lorem ipsum dolor sit amet consectetur adipiscing elit. Sit amet consectetur adipiscing elit quisque faucibus ex. Adipiscing elit quisque faucibus ex sapien vitae pellentesque.", evidence: "Lorem ipsum dolor sit amet consectetur adipiscing elit.", track: "Persona", week: 1, duration: 2, trackId: 0, levelId: 2, cardIndex: 0, dependencies: null},
            {id: "2-2-0", name: "Agenda tu asistencia a un evento de tu comunidad", details: "Lorem ipsum dolor sit amet consectetur adipiscing elit. Sit amet consectetur adipiscing elit quisque faucibus ex. Adipiscing elit quisque faucibus ex sapien vitae pellentesque.", evidence: "Lorem ipsum dolor sit amet consectetur adipiscing elit.", track: "Comunidad", week: 1, duration: 2, trackId: 2, levelId: 2, cardIndex: 0, dependencies: null},
            {id: "2-2-0", name: "Amistad (emprendedora) por correspondencia", details: "Lorem ipsum dolor sit amet consectetur adipiscing elit. Sit amet consectetur adipiscing elit quisque faucibus ex. Adipiscing elit quisque faucibus ex sapien vitae pellentesque.", evidence: "Lorem ipsum dolor sit amet consectetur adipiscing elit.", track: "Comunidad", week: 2, duration: 2, trackId: 2, levelId: 2, cardIndex: 0, dependencies: null},
            {id: "0-2-0", name: "Una cita contigo", details: "Lorem ipsum dolor sit amet consectetur adipiscing elit. Sit amet consectetur adipiscing elit quisque faucibus ex. Adipiscing elit quisque faucibus ex sapien vitae pellentesque.", evidence: "Lorem ipsum dolor sit amet consectetur adipiscing elit.", track: "Persona", week: 2, duration: 2, trackId: 0, levelId: 2, cardIndex: 0, dependencies: null},
            {id: "0-2-0", name: "Platica con extraños", details: "Lorem ipsum dolor sit amet consectetur adipiscing elit. Sit amet consectetur adipiscing elit quisque faucibus ex. Adipiscing elit quisque faucibus ex sapien vitae pellentesque.", evidence: "Lorem ipsum dolor sit amet consectetur adipiscing elit.", track: "Persona", week: 3, duration: 2, trackId: 0, levelId: 2, cardIndex: 0, dependencies: null},
            {id: "2-3-0", name: "¡Sal de la rutina!", details: "Lorem ipsum dolor sit amet consectetur adipiscing elit. Sit amet consectetur adipiscing elit quisque faucibus ex. Adipiscing elit quisque faucibus ex sapien vitae pellentesque.", evidence: "Lorem ipsum dolor sit amet consectetur adipiscing elit.", track: "Comunidad", week: 1, duration: 4, trackId: 2, levelId: 3, cardIndex: 0, dependencies: null},
            {id: "2-2-0", name: "Define tu mentor ideal", details: "Lorem ipsum dolor sit amet consectetur adipiscing elit. Sit amet consectetur adipiscing elit quisque faucibus ex. Adipiscing elit quisque faucibus ex sapien vitae pellentesque.", evidence: "Lorem ipsum dolor sit amet consectetur adipiscing elit.", track: "Comunidad", week: 3, duration: 2, trackId: 2, levelId: 2, cardIndex: 0, dependencies: null},
            {id: "1-3-0", name: "Lectura de: Deep Work de Cal Newport", details: "Lorem ipsum dolor sit amet consectetur adipiscing elit. Sit amet consectetur adipiscing elit quisque faucibus ex. Adipiscing elit quisque faucibus ex sapien vitae pellentesque.", evidence: "Lorem ipsum dolor sit amet consectetur adipiscing elit.", track: "Iniciativa", week: 1, duration: 4, trackId: 1, levelId: 3, cardIndex: 0, dependencies: null},
            {id: "1-3-0", name: "Lectura de: The One Thing de Gary W. Keller & Jay Papasan", details: "Lorem ipsum dolor sit amet consectetur adipiscing elit. Sit amet consectetur adipiscing elit quisque faucibus ex. Adipiscing elit quisque faucibus ex sapien vitae pellentesque.", evidence: "Lorem ipsum dolor sit amet consectetur adipiscing elit.", track: "Iniciativa", week: 2, duration: 4, trackId: 1, levelId: 3, cardIndex: 0, dependencies: null},
            {id: "1-3-0", name: "Evalúa a tu equipo", details: "Lorem ipsum dolor sit amet consectetur adipiscing elit. Sit amet consectetur adipiscing elit quisque faucibus ex. Adipiscing elit quisque faucibus ex sapien vitae pellentesque.", evidence: "Lorem ipsum dolor sit amet consectetur adipiscing elit.", track: "Iniciativa", week: 3, duration: 4, trackId: 1, levelId: 3, cardIndex: 0, dependencies: null},
            {id: "1-2-1", name: "Lectura de: Measure what matters de John Doerr", details: "Lorem ipsum dolor sit amet consectetur adipiscing elit. Sit amet consectetur adipiscing elit quisque faucibus ex. Adipiscing elit quisque faucibus ex sapien vitae pellentesque.", evidence: "Lorem ipsum dolor sit amet consectetur adipiscing elit.", track: "Iniciativa", week: 2, duration: 2, trackId: 1, levelId: 2, cardIndex: 1, dependencies: null},
            {id: "2-3-0", name: "Identifica recursos óptimos", details: "Lorem ipsum dolor sit amet consectetur adipiscing elit. Sit amet consectetur adipiscing elit quisque faucibus ex. Adipiscing elit quisque faucibus ex sapien vitae pellentesque.", evidence: "Lorem ipsum dolor sit amet consectetur adipiscing elit.", track: "Comunidad", week: 3, duration: 4, trackId: 2, levelId: 3, cardIndex: 0, dependencies: null},
            {id: "2-3-1", name: "Crece tu red", details: "Lorem ipsum dolor sit amet consectetur adipiscing elit. Sit amet consectetur adipiscing elit quisque faucibus ex. Adipiscing elit quisque faucibus ex sapien vitae pellentesque.", evidence: "Lorem ipsum dolor sit amet consectetur adipiscing elit.", track: "Comunidad", week: 3, duration: 4, trackId: 2, levelId: 3, cardIndex: 1, dependencies: null},
            {id: "0-3-0", name: "Prototipa tu idea", details: "Lorem ipsum dolor sit amet consectetur adipiscing elit. Sit amet consectetur adipiscing elit quisque faucibus ex. Adipiscing elit quisque faucibus ex sapien vitae pellentesque.", evidence: "Lorem ipsum dolor sit amet consectetur adipiscing elit.", track: "Persona", week: 3, duration: 4, trackId: 0, levelId: 3, cardIndex: 0, dependencies: null},
            {id: "2-2-0", name: "Conoce tu ecosistema de emprendimiento", details: "Lorem ipsum dolor sit amet consectetur adipiscing elit. Sit amet consectetur adipiscing elit quisque faucibus ex. Adipiscing elit quisque faucibus ex sapien vitae pellentesque.", evidence: "Lorem ipsum dolor sit amet consectetur adipiscing elit.", track: "Comunidad", week: 4, duration: 2, trackId: 2, levelId: 2, cardIndex: 0, dependencies: null},
            {id: "1-2-1", name: "Aprovecha el ecosistema de emprendimiento", details: "Lorem ipsum dolor sit amet consectetur adipiscing elit. Sit amet consectetur adipiscing elit quisque faucibus ex. Adipiscing elit quisque faucibus ex sapien vitae pellentesque.", evidence: "Lorem ipsum dolor sit amet consectetur adipiscing elit.", track: "Iniciativa", week: 4, duration: 2, trackId: 1, levelId: 2, cardIndex: 1, dependencies: "2-2-0"},
            {id: "0-3-0", name: "Postmortem personal", details: "Lorem ipsum dolor sit amet consectetur adipiscing elit. Sit amet consectetur adipiscing elit quisque faucibus ex. Adipiscing elit quisque faucibus ex sapien vitae pellentesque.", evidence: "Lorem ipsum dolor sit amet consectetur adipiscing elit.", track: "Persona", week: 5, duration: 4, trackId: 0, levelId: 3, cardIndex: 0, dependencies: null},
            {id: "1-3-0", name: "Propiedad Intelectual", details: "Lorem ipsum dolor sit amet consectetur adipiscing elit. Sit amet consectetur adipiscing elit quisque faucibus ex. Adipiscing elit quisque faucibus ex sapien vitae pellentesque.", evidence: "Lorem ipsum dolor sit amet consectetur adipiscing elit.", track: "Iniciativa", week: 5, duration: 4, trackId: 1, levelId: 3, cardIndex: 0, dependencies: null},
            {id: "2-2-0", name: "Conviértete en Mentor", details: "Lorem ipsum dolor sit amet consectetur adipiscing elit. Sit amet consectetur adipiscing elit quisque faucibus ex. Adipiscing elit quisque faucibus ex sapien vitae pellentesque.", evidence: "Lorem ipsum dolor sit amet consectetur adipiscing elit.", track: "Comunidad", week: 5, duration: 2, trackId: 2, levelId: 2, cardIndex: 0, dependencies: null},
            {id: "2-3-2", name: "Crea tu propia red", details: "Lorem ipsum dolor sit amet consectetur adipiscing elit. Sit amet consectetur adipiscing elit quisque faucibus ex. Adipiscing elit quisque faucibus ex sapien vitae pellentesque.", evidence: "Lorem ipsum dolor sit amet consectetur adipiscing elit.", track: "Comunidad", week: 3, duration: 4, trackId: 2, levelId: 3, cardIndex: 2, dependencies: null},
            {id: "0-1-1", name: "Podcast sobre mentalidad emprendedora", details: "Lorem ipsum dolor sit amet consectetur adipiscing elit. Sit amet consectetur adipiscing elit quisque faucibus ex. Adipiscing elit quisque faucibus ex sapien vitae pellentesque.", evidence: "Lorem ipsum dolor sit amet consectetur adipiscing elit.", track: "Persona", week: 1, duration: 1, trackId: 0, levelId: 1, cardIndex: 1, dependencies: null},
            {id: "1-1-0", name: "Pide retroalimentación", details: "Lorem ipsum dolor sit amet consectetur adipiscing elit. Sit amet consectetur adipiscing elit quisque faucibus ex. Adipiscing elit quisque faucibus ex sapien vitae pellentesque.", evidence: "Lorem ipsum dolor sit amet consectetur adipiscing elit.", track: "Iniciativa", week: 2, duration: 1, trackId: 1, levelId: 1, cardIndex: 0, dependencies: null},
            {id: "0-1-0", name: "Podcast sobre proyectos de emprendimiento", details: "Lorem ipsum dolor sit amet consectetur adipiscing elit. Sit amet consectetur adipiscing elit quisque faucibus ex. Adipiscing elit quisque faucibus ex sapien vitae pellentesque.", evidence: "Lorem ipsum dolor sit amet consectetur adipiscing elit.", track: "Persona", week: 3, duration: 1, trackId: 0, levelId: 1, cardIndex: 0, dependencies: null},
            {id: "2-1-0", name: "Conecta con tu red", details: "Lorem ipsum dolor sit amet consectetur adipiscing elit. Sit amet consectetur adipiscing elit quisque faucibus ex. Adipiscing elit quisque faucibus ex sapien vitae pellentesque.", evidence: "Lorem ipsum dolor sit amet consectetur adipiscing elit.", track: "Comunidad", week: 3, duration: 1, trackId: 2, levelId: 1, cardIndex: 0, dependencies: null},
            {id: "2-1-0", name: "Plasma tu visión", details: "Lorem ipsum dolor sit amet consectetur adipiscing elit. Sit amet consectetur adipiscing elit quisque faucibus ex. Adipiscing elit quisque faucibus ex sapien vitae pellentesque.", evidence: "Lorem ipsum dolor sit amet consectetur adipiscing elit.", track: "Comunidad", week: 2, duration: 1, trackId: 2, levelId: 1, cardIndex: 0, dependencies: null},
            {id: "0-1-1", name: "Imagina posibles futuros", details: "Lorem ipsum dolor sit amet consectetur adipiscing elit. Sit amet consectetur adipiscing elit quisque faucibus ex. Adipiscing elit quisque faucibus ex sapien vitae pellentesque.", evidence: "Lorem ipsum dolor sit amet consectetur adipiscing elit.", track: "Persona", week: 3, duration: 1, trackId: 0, levelId: 1, cardIndex: 1, dependencies: null},
            {id: "0-1-2", name: "Encuentra tus virtudes y fortalezas", details: "Lorem ipsum dolor sit amet consectetur adipiscing elit. Sit amet consectetur adipiscing elit quisque faucibus ex. Adipiscing elit quisque faucibus ex sapien vitae pellentesque.", evidence: "Lorem ipsum dolor sit amet consectetur adipiscing elit.", track: "Persona", week: 1, duration: 1, trackId: 0, levelId: 1, cardIndex: 2, dependencies: null},
            {id: "2-1-1", name: "Generosidad Emprendedora", details: "Lorem ipsum dolor sit amet consectetur adipiscing elit. Sit amet consectetur adipiscing elit quisque faucibus ex. Adipiscing elit quisque faucibus ex sapien vitae pellentesque.", evidence: "Lorem ipsum dolor sit amet consectetur adipiscing elit.", track: "Comunidad", week: 2, duration: 1, trackId: 2, levelId: 1, cardIndex: 1, dependencies: null},
            {id: "0-1-0", name: "Rocket + Elevator Pitch", details: "Lorem ipsum dolor sit amet consectetur adipiscing elit. Sit amet consectetur adipiscing elit quisque faucibus ex. Adipiscing elit quisque faucibus ex sapien vitae pellentesque.", evidence: "Lorem ipsum dolor sit amet consectetur adipiscing elit.", track: "Persona", week: 2, duration: 1, trackId: 0, levelId: 1, cardIndex: 0, dependencies: null},
            {id: "2-1-0", name: "Podcast sobre ecosistemas de emprendimiento", details: "Lorem ipsum dolor sit amet consectetur adipiscing elit. Sit amet consectetur adipiscing elit quisque faucibus ex. Adipiscing elit quisque faucibus ex sapien vitae pellentesque.", evidence: "Lorem ipsum dolor sit amet consectetur adipiscing elit.", track: "Comunidad", week: 4, duration: 1, trackId: 2, levelId: 1, cardIndex: 0, dependencies: null},
            {id: "2-1-1", name: "Turismo Emprendedor", details: "Lorem ipsum dolor sit amet consectetur adipiscing elit. Sit amet consectetur adipiscing elit quisque faucibus ex. Adipiscing elit quisque faucibus ex sapien vitae pellentesque.", evidence: "Lorem ipsum dolor sit amet consectetur adipiscing elit.", track: "Comunidad", week: 4, duration: 1, trackId: 2, levelId: 1, cardIndex: 1, dependencies: null},
            {id: "0-1-0", name: "Desarrolla una landing page", details: "Lorem ipsum dolor sit amet consectetur adipiscing elit. Sit amet consectetur adipiscing elit quisque faucibus ex. Adipiscing elit quisque faucibus ex sapien vitae pellentesque.", evidence: "Lorem ipsum dolor sit amet consectetur adipiscing elit.", track: "Persona", week: 4, duration: 1, trackId: 0, levelId: 1, cardIndex: 0, dependencies: null},
            {id: "1-1-1", name: "Genera un blog o vlog", details: "Lorem ipsum dolor sit amet consectetur adipiscing elit. Sit amet consectetur adipiscing elit quisque faucibus ex. Adipiscing elit quisque faucibus ex sapien vitae pellentesque.", evidence: "Lorem ipsum dolor sit amet consectetur adipiscing elit.", track: "Iniciativa", week: 4, duration: 1, trackId: 1, levelId: 1, cardIndex: 1, dependencies: null}
        ];

        // Configuración de tracks
        const tracks = [
            {
                id: 0,
                name: "Persona",
                icon: "👤",
                color: "track-persona",
                description: "Desarrollo personal y autoconocimiento emprendedor",
                borderColor: "border-purple-300"
            },
            {
                id: 1,
                name: "Proyecto", 
                icon: "💼",
                color: "track-proyecto",
                description: "Desarrollo de tu idea de negocio",
                borderColor: "border-blue-300"
            },
            {
                id: 2,
                name: "Comunidad",
                icon: "👥",
                color: "track-comunidad",
                description: "Networking y construcción de redes",
                borderColor: "border-green-300"
            }
        ];

        // Configuración de niveles
        const levels = [
            { id: 1, name: "Nivel 1", time: "1-2 horas", points: 1, color: "bg-yellow-400", textColor: "text-yellow-800" },
            { id: 2, name: "Nivel 2", time: "2-3 horas", points: 2, color: "bg-orange-400", textColor: "text-orange-800" },
            { id: 3, name: "Nivel 3", time: "3+ horas", points: 4, color: "bg-red-400", textColor: "text-red-800" }
        ];

        // Mapeo de tracks del CSV a nuestros tracks
        const trackMapping = {
            "Persona": 0,
            "Iniciativa": 1,
            "Comunidad": 2
        };

        // Mapeo de duración a levelId
        const durationToLevel = {
            1: 1, // 1-2 horas = Nivel 1
            2: 2, // 2-3 horas = Nivel 2  
            4: 3  // 3+ horas = Nivel 3
        };

        // Funciones de utilidad
        function saveProgress() {
            localStorage.setItem('ventureGuideProgress', JSON.stringify(state.completedChallenges));
        }

        function exportProgress() {
            const data = {
                timestamp: new Date().toISOString(),
                completedChallenges: state.completedChallenges,
                totalPoints: getTotalPoints(),
                progressByTrack: tracks.map(track => ({
                    trackName: track.name,
                    pointsByWeek: getPointsByTrackAndWeek(track.id)
                }))
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `herramientas-exito-emprendedor-${new Date().toLocaleDateString()}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function toggleCardCompletion(cardData) {
            const cardString = JSON.stringify(cardData);
            if (state.completedChallenges.find(c => JSON.stringify(c) === cardString)) {
                state.completedChallenges = state.completedChallenges.filter(c => JSON.stringify(c) !== cardString);
            } else {
                state.completedChallenges = [...state.completedChallenges, cardData];
            }
            saveProgress();
            render();
        }

        function isCardCompleted(cardData) {
            const cardString = JSON.stringify(cardData);
            return state.completedChallenges.find(c => JSON.stringify(c) === cardString) !== undefined;
        }

        function getTotalPoints() {
            return state.completedChallenges.reduce((total, card) => {
                const level = levels.find(l => l.id === durationToLevel[card.duration]);
                return total + (level ? level.points : 0);
            }, 0);
        }

        function getPointsByWeek(week) {
            return state.completedChallenges
                .filter(card => card.week === week)
                .reduce((total, card) => {
                    const level = levels.find(l => l.id === durationToLevel[card.duration]);
                    return total + (level ? level.points : 0);
                }, 0);
        }

        function getPointsByTrackAndWeek(trackId) {
            const result = {};
            for (let week = 1; week <= 5; week++) {
                result[week] = state.completedChallenges
                    .filter(card => trackMapping[card.track] === trackId && card.week === week)
                    .reduce((total, card) => {
                        const level = levels.find(l => l.id === durationToLevel[card.duration]);
                        return total + (level ? level.points : 0);
                    }, 0);
            }
            return result;
        }

        function canAccessWeek(week) {
            if (week === 1) return true;
            const previousWeekPoints = getPointsByWeek(week - 1);
            return previousWeekPoints >= 12;
        }

        function isDependencyMet(cardData) {
            if (!cardData.dependencies) return true;
            
            // Buscar la tarjeta de dependencia
            const dependencyCard = cardsData.find(c => c.id === cardData.dependencies);
            if (!dependencyCard) return true;
            
            return isCardCompleted(dependencyCard);
        }

        function getCardsForCurrentTrackAndWeek() {
            const currentTrackName = tracks[state.selectedTrack].name;
            const trackNameMapping = {
                "Persona": "Persona",
                "Proyecto": "Iniciativa", 
                "Comunidad": "Comunidad"
            };
            
            return cardsData.filter(card => 
                card.track === trackNameMapping[currentTrackName] && 
                card.week === state.selectedWeek
            );
        }

        // Función de renderizado
        function render() {
            const currentTrack = tracks[state.selectedTrack];
            const weekCards = getCardsForCurrentTrackAndWeek();
            
            document.getElementById('app').innerHTML = `
                <!-- Header -->
                <div class="${currentTrack.color} text-white p-6 rounded-b-3xl">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <h1 class="text-xl font-bold">Herramientas para el Éxito Emprendedor</h1>
                            <p class="text-sm opacity-90">Tablero de Retos</p>
                        </div>
                        <div class="text-right">
                            <div class="bg-white bg-opacity-20 rounded-full px-3 py-1">
                                <span class="text-sm font-bold">${getTotalPoints()} pts</span>
                            </div>
                            <p class="text-xs mt-1 opacity-75">Total ganados</p>
                        </div>
                    </div>
                    
                    <div class="flex items-center justify-between">
                        <button onclick="changeTrack(-1)" class="bg-white bg-opacity-20 rounded-full p-2 hover:bg-opacity-30 transition-colors">
                            ◀
                        </button>
                        
                        <div class="text-center flex-1">
                            <div class="flex items-center justify-center gap-2 mb-2">
                                <span class="text-2xl">${currentTrack.icon}</span>
                                <h2 class="text-xl font-bold">${currentTrack.name}</h2>
                            </div>
                            <p class="text-xs opacity-90">${currentTrack.description}</p>
                        </div>
                        
                        <button onclick="changeTrack(1)" class="bg-white bg-opacity-20 rounded-full p-2 hover:bg-opacity-30 transition-colors">
                            ▶
                        </button>
                    </div>
                </div>

                <!-- Track Tabs -->
                <div class="flex bg-white mx-4 -mt-4 rounded-xl shadow-sm border border-gray-200 relative z-10">
                    ${tracks.map((track, index) => `
                        <button onclick="setTrack(${index})" class="flex-1 p-3 text-center rounded-xl transition-colors ${
                            state.selectedTrack === index 
                                ? `${track.color} text-white` 
                                : 'text-gray-600 hover:bg-gray-50'
                        }">
                            <div class="text-xl mb-1">${track.icon}</div>
                            <span class="text-xs font-medium">${track.name}</span>
                        </button>
                    `).join('')}
                </div>

                <!-- Week Selector -->
                <div class="mx-4 mt-4 bg-white rounded-xl p-4 shadow-sm border border-gray-200">
                    <h3 class="font-bold mb-3 text-center">Seleccionar Semana</h3>
                    <div class="flex gap-2">
                        ${Array.from({length: 5}, (_, i) => i + 1).map(week => {
                            const canAccess = canAccessWeek(week);
                            const weekPoints = getPointsByWeek(week);
                            return `
                                <button 
                                    onclick="${canAccess ? `setWeek(${week})` : 'void(0)'}" 
                                    class="flex-1 p-3 rounded-lg text-center transition-colors ${
                                        state.selectedWeek === week 
                                            ? `${currentTrack.color} text-white` 
                                            : canAccess 
                                                ? 'bg-gray-100 text-gray-700 hover:bg-gray-200' 
                                                : 'bg-gray-50 text-gray-400 cursor-not-allowed'
                                    }">
                                    <div class="font-bold text-sm">S${week}</div>
                                    <div class="text-xs mt-1">${weekPoints} pts</div>
                                    ${!canAccess && week > 1 ? '<div class="text-xs">🔒</div>' : ''}
                                </button>
                            `;
                        }).join('')}
                    </div>
                    ${!canAccessWeek(state.selectedWeek + 1) && state.selectedWeek < 5 ? 
                        `<p class="text-xs text-gray-500 text-center mt-2">Completa 12 puntos en la semana ${state.selectedWeek} para desbloquear la siguiente</p>` 
                        : ''}
                </div>

                <!-- Challenge Cards by Level -->
                <div class="p-4 space-y-6">
                    ${levels.map(level => {
                        const levelCards = weekCards.filter(card => durationToLevel[card.duration] === level.id);
                        if (levelCards.length === 0) return '';
                        
                        return `
                            <div class="bg-white rounded-2xl p-4">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="flex items-center gap-2">
                                        <div class="${level.color} w-3 h-3 rounded-full"></div>
                                        <h3 class="font-bold text-gray-800">${level.name}</h3>
                                        <span class="text-xs text-gray-500">(${level.time})</span>
                                    </div>
                                    <div class="${level.color} ${level.textColor} px-2 py-1 rounded-full text-xs font-bold">
                                        ${level.points} pts c/u
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-1 gap-3">
                                    ${levelCards.map(card => {
                                        const isCompleted = isCardCompleted(card);
                                        const dependencyMet = isDependencyMet(card);
                                        const isDisabled = !dependencyMet;
                                        
                                        return `
                                            <div onclick="${isDisabled ? 'void(0)' : `openCard(${JSON.stringify(card).replace(/"/g, '&quot;')})`}" 
                                                 class="bg-white rounded-xl border-2 ${
                                                     isCompleted ? 'border-green-300 bg-green-50' : 
                                                     isDisabled ? 'border-gray-200 bg-gray-100' : 'border-gray-200'
                                                 } p-4 ${isDisabled ? 'cursor-not-allowed opacity-50' : 'cursor-pointer hover:shadow-md'} transition-all duration-200">
                                                <div class="flex items-start justify-between mb-2">
                                                    <div class="flex-1">
                                                        <h4 class="font-semibold text-sm ${
                                                            isCompleted ? 'text-green-800' : 
                                                            isDisabled ? 'text-gray-500' : 'text-gray-800'
                                                        }">
                                                            ${card.name}
                                                        </h4>
                                                        ${isDisabled ? '<p class="text-xs mt-1 text-gray-400">🔒 Dependencia requerida</p>' : ''}
                                                    </div>
                                                    ${isCompleted ? '<div class="bg-green-500 text-white rounded-full p-1 text-xs">★</div>' : ''}
                                                </div>
                                                
                                                <div class="flex items-center justify-between">
                                                    <div class="flex items-center gap-2">
                                                        <span class="text-xs ${isDisabled ? 'text-gray-400' : 'text-gray-500'}">⏱ ${level.time}</span>
                                                    </div>
                                                    <div class="${level.color} ${level.textColor} px-2 py-1 rounded-full text-xs font-bold">
                                                        ${level.points} pts
                                                    </div>
                                                </div>
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>

                <!-- Export Button -->
                <div class="mx-4 mb-6">
                    <button onclick="exportProgress()" class="w-full bg-gradient-to-r from-green-500 to-emerald-500 text-white py-3 rounded-xl font-semibold hover:from-green-600 hover:to-emerald-600 transition-colors">
                        📥 Exportar Mi Progreso
                    </button>
                </div>

                <!-- Summary Stats -->
                <div class="mx-4 mb-6 bg-white rounded-2xl p-4">
                    <h3 class="font-bold mb-3 flex items-center gap-2">
                        🏆 Resumen de Progreso por Semana
                    </h3>
                    <div class="space-y-3">
                        ${tracks.map(track => {
                            const pointsByWeek = getPointsByTrackAndWeek(track.id);
                            return `
                                <div class="border-b border-gray-100 pb-3 last:border-b-0">
                                    <div class="flex items-center gap-2 mb-2">
                                        <div class="${track.color} w-6 h-6 rounded-full flex items-center justify-center text-white text-sm">
                                            ${track.icon}
                                        </div>
                                        <span class="font-semibold text-sm">${track.name}</span>
                                    </div>
                                    <div class="grid grid-cols-5 gap-2 ml-8">
                                        ${Array.from({length: 5}, (_, i) => i + 1).map(week => `
                                            <div class="text-center">
                                                <div class="text-xs text-gray-500">S${week}</div>
                                                <div class="text-sm font-bold ${pointsByWeek[week] > 0 ? 'text-green-600' : 'text-gray-400'}">
                                                    ${pointsByWeek[week]} pts
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>

                ${state.selectedCard ? renderModal() : ''}
            `;
        }

        function renderModal() {
            const card = state.selectedCard;
            const level = levels.find(l => l.id === durationToLevel[card.duration]);
            const completed = isCardCompleted(card);
            
            return `
                <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                    <div class="bg-white rounded-2xl p-6 max-w-sm w-full max-h-96 overflow-y-auto">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="text-lg font-bold">${card.name}</h3>
                                <p class="text-sm text-gray-600 mt-2">${card.details}</p>
                            </div>
                            <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700 text-xl">
                                ✕
                            </button>
                        </div>
                        
                        <div class="bg-gray-50 rounded-lg p-3 mb-4">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-sm font-medium">Duración estimada:</span>
                                <span class="text-sm text-gray-600">${level.time}</span>
                            </div>
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-sm font-medium">Puntos:</span>
                                <span class="${level.color} ${level.textColor} px-2 py-1 rounded-full text-xs font-bold">
                                    ${level.points} puntos
                                </span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm font-medium">Semana:</span>
                                <span class="text-sm text-gray-600">Semana ${card.week}</span>
                            </div>
                        </div>

                        <!-- Evidencia Sugerida -->
                        <div class="bg-blue-50 rounded-lg p-3 mb-4">
                            <h4 class="text-sm font-bold text-blue-800 mb-2">📋 Evidencia Sugerida</h4>
                            <p class="text-sm text-blue-700">${card.evidence}</p>
                        </div>
                        
                        <div class="space-y-3">
                            <button onclick="toggleCardCompletion(state.selectedCard); closeModal();" 
                                    class="w-full py-3 rounded-xl font-semibold transition-colors ${
                                        completed 
                                            ? 'bg-gray-200 text-gray-600 hover:bg-gray-300' 
                                            : 'bg-gradient-to-r from-green-500 to-emerald-500 text-white hover:from-green-600 hover:to-emerald-600'
                                    }">
                                ${completed ? 'Marcar como Pendiente' : 'Completar Reto'}
                            </button>
                            
                            <button onclick="closeModal()" class="w-full bg-white border-2 border-gray-300 text-gray-700 py-3 rounded-xl font-semibold hover:bg-gray-50 transition-colors">
                                Cerrar
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        // Event handlers
        function changeTrack(direction) {
            state.selectedTrack = (state.selectedTrack + direction + tracks.length) % tracks.length;
            render();
        }

        function setTrack(index) {
            state.selectedTrack = index;
            render();
        }

        function setWeek(week) {
            if (canAccessWeek(week)) {
                state.selectedWeek = week;
                render();
            }
        }

        function openCard(cardData) {
            state.selectedCard = cardData;
            render();
        }

        function closeModal() {
            state.selectedCard = null;
            render();
        }

        // Inicializar la aplicación
        render();
    </script>
</body>
</html>
